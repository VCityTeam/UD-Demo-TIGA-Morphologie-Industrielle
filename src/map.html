<!DOCTYPE html>
<html>
  <head>
    <title>Carte narrative</title>
    <link rel="stylesheet" href="../css/view.css" />
    <link rel="stylesheet" href="../css/rSlider.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div id="nav_div">
      <button
        class="nav_button with_right_border"
        onclick="location.href = '../index.html';"
      >
        Accueil
      </button>
      <button
        class="nav_button with_right_border"
        onclick="location.href = './bat.html';"
      >
        Évolution du bâtiment
      </button>
      <button
        class="nav_button with_right_border"
        onclick="location.href = './csp.html';"
      >
        Répartion des CSP
      </button>
      <button class="nav_button" onclick="location.href = './eff.html';">
        Répartion des effectifs
      </button>
    </div>
    <div id="main_div">
      <div id="full_view">
        <div id="guided_tour_div"></div>
        <div id="full_view_container" class="view_container"></div>
      </div>
    </div>
    <script src="../dist/development/bundle.js"></script>
    <script type="text/javascript">
      app
        .loadMultipleJSON([
          '../assets/config/extent.json',
          '../assets/config/crs.json',
          '../assets/config/layer/base_maps.json',
          '../assets/config/layer/elevation.json',
          '../assets/config/tour.json',
        ])
        .then((configs) => {
          const crs = configs['crs'][1].name;
          app.proj4.default.defs(crs, configs['crs'][1].transform);

          const extent = new app.itowns.Extent(
            configs['extent'][1].name,
            parseInt(configs['extent'][1].west),
            parseInt(configs['extent'][1].east),
            parseInt(configs['extent'][1].south),
            parseInt(configs['extent'][1].north)
          );

          // ADD VIEWS
          const placement = {
            coord: new app.itowns.Coordinates('EPSG:3946', 1847647, 5169288),
            range: 7000,
          };

          const viewDomElement = document.getElementById('full_view_container');
          const view = new app.itowns.PlanarView(viewDomElement, extent, {
            maxSubdivisionLevel: 12,
            placement: placement,
          });
          app.initScene(
            view.camera.camera3D,
            view.mainLoop.gfxEngine.renderer,
            view.scene
          );
          const scale = new app.Scale(view, {
            position: 'bottom-right',
            translate: { x: 10, y: -40 },
          });

          // ADD LAYERS
          const baseMap = app.BaseMapLayer(configs['base_maps'], extent);
          view.addLayer(baseMap);
          console.log(baseMap.id);

          const elevationLayer = app.ElevationLayer(
            configs['elevation'],
            extent
          );
          view.addLayer(elevationLayer);
          console.log(elevationLayer.id);

          // ADD GUIDED TOUR
          const guidedTour = new app.GuidedTour(
            view,
            configs['tour'].tour,
            configs['tour'].media
          );
          guidedTour.goToStep(guidedTour.startIndex);
          guidedTour.domElement.classList.add('widget_guided_tour');
          guidedTour.mediaContainer.classList.add('media_container');
          guidedTour.previousButton.innerText = 'Previous';
          guidedTour.nextButton.innerText = 'Next';

          document
            .getElementById('guided_tour_div')
            .appendChild(guidedTour.domElement);
        });
    </script>
  </body>
</html>
